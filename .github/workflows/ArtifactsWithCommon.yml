
name : push

on: [ push ]

jobs :

  build :
    uses : dmvict/Test/.github/workflows/Linux.yml@master

  last :
    needs: [ build ]
    if: startsWith( github.ref, 'refs/tags/v' )
    runs-on : ubuntu-latest
    steps :
      - uses: actions/checkout@v2
      - run: rm -rf out/*
      - uses: actions/download-artifact@v2
        with:
          name: ubuntu
          path: out/linux_release
      - uses: actions/download-artifact@v2
        with:
          name: macos
          path: out/macos_release
      - uses: actions/download-artifact@v2
        with:
          name: windows
          path: out/windows_release
      - name: Pushes to another repository
        uses: cpina/github-action-push-to-another-repository@main
        env:
          API_TOKEN_GITHUB: ${{ secrets.PRIVATE_TOKEN }}
        with:
          source-directory: out
          target-directory: out/${{ github.ref_name }}
          destination-github-username: 'dmvict'
          destination-repository-name: 'test-push'
          user-email: dm.vict.kr@gmail.com
          target-branch: master
      - run: git checkout out/
      - run: rm -rf out/*
      - run: echo '[linux](https://github.com/dmvict/test-push/raw/master/out/${{ github.ref_name }}/linux_release/test)' >> out/${{ github.ref_name }}.md
      - run: echo ' ' >> out/${{ github.ref_name }}.md
      - run: echo '[macos](https://github.com/dmvict/test-push/raw/master/out/${{ github.ref_name }}/macos_release/test)' >> out/${{ github.ref_name }}.md
      - run: echo ' ' >> out/${{ github.ref_name }}.md
      - run: echo '[windows](https://github.com/dmvict/test-push/raw/master/out/${{ github.ref_name }}/windows_release)' >> out/${{ github.ref_name }}.md
      - uses: quizlet/commit-changes@v0.2.0
        with:
          token: ${{ secrets.PRIVATE_TOKEN }}
          message: Automated commit
          glob-patterns: out/

